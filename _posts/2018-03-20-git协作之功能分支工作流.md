---
title: git协作之功能分支工作流
date: 2018-03-20
tags: [git]
---

内容: 介绍git工作流的一种, 功能分支工作流

精华: 对比了集中式工作流的优缺点, 对于工作流的实际git命令行操作有详细描述

<!-- more -->

# 概述

最简单的集中式工作流， 远程分支/本地分支都只有一个master， 所有人都对齐总有读写权

我第一次带队， 就这样子， 过程中遇到了如下几个问题

1. 组员第一次接触git并用于协作， 误操作push到了master
2. 一个无法运行的版本， 直接被push到了master， 使得大家pull后项目跑不起来
3. 组员调bug遇到困难， 移交代码给其他人来帮忙调试， 需要push到master或者新开分支

所以需要

* 隔离组员和master: 建立dev和组员分支
* 限制组员的push权限: 组员只对自己的组员分支有push权， 对于dev和master无push权
* 固定组员分支: 这样其他人帮忙调试， 只需要切换分支即可

由此演变出功能分支工作流

# 功能分支工作流

## 分支

* master: 发布relase版本， 管理员负责从dev合并进来
* dev: 开发分支， 只有管理员能push， 其他人提pull request
* 各个组员分支: 跟踪dev分支

## 协作流程

### 管理员

1. 建立仓库， master为默认分支
2. 从master衍生出dev分支
3. 设置master/dev分支只能管理员push
4. 默认操作dev分支: git branch --set-upstream-to=origin/dev

### 组员

1. clone
2. dev衍生出组员分支
3. 默认操作组员分支: git --set-upstream-to=origin/组员分支
4. 功能完成后push到组员分支, 提pull request请求
5. dev更新后, 组员pull， dev rebase到组员分支

# 实际操作

## 管理员

```
//确定master为远程默认分支后
//从master衍生dev分支
git checkout -b dev

//网页上锁定master/dev分支权限

//1. 将dev分支推到远程仓库
//2. 默认跟踪dev分支
//这里如果是空文件夹应该是跑不通的, 主要是说明要做到上面两件事
git push -u origin dev
```

## 组员

### 建仓

```
git clone
//切换到dev分支
git checkout dev
//从dev分支衍生组员分支
git checkout -b huangkaibo
//这里空文件夹应该也是不行的
git push -u origin huangkaibo
```

### 操作

```
//正常编码后
git add .
git commit -m "注释"
git push
//然后在网页上提pull request
//同意后
git pull origin dev:dev
```

### 同步

```
git pull origin dev:dev
git checkout huangkaibo
git rebase master
```
